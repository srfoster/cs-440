id: "m4-ac3-algorithm"
type: "short-answer"
chapter: 2
question: |
  **Solve Sudoku using the AC-3 arc consistency algorithm.**

  In the previous question, forward checking pruned neighbors after each assignment. But what if we propagate constraints before any assignment? Arc consistency is a preprocessing technique that shrinks domains by enforcing local consistency: for every cell-cell constraint (e.g., C₀₀ and C₀₁ in same row), every value in one cell's domain must have a compatible value in the other's domain. For Sudoku, this means: if C₀₀ can be {1,2,3} and C₀₁ can be {2}, remove 2 from C₀₀'s domain. Propagating these removals cascades: shrinking C₀₀ might enable shrinking C₀₂, and so on. For "easy" Sudoku puzzles, AC-3 alone solves them—every cell reduces to a single value without search! This matters because it shows how inference can replace search.

  **Level 0** Discuss why forward checking isn't enough for Sudoku. Forward checking only prunes after assignment. But Sudoku clues constrain neighbors immediately. Example: if row 0 has clue C₀₀=5, we should remove 5 from all row 0 domains before any search. AC-3 does this. Why is AC-3 still incomplete? Example: a Sudoku grid that's arc-consistent but has no solution (though rare). Compare with 8-queens (Chapter 1): there we used objective functions; here we use constraint propagation.

  **Level 1** Define arc consistency for Sudoku. For every arc (Cᵢⱼ, C_kₗ) (two cells in same row/col/box), every value v ∈ Dᵢⱼ must have some value w ∈ D_kₗ such that v ≠ w (Sudoku's AllDifferent constraint). If Cᵢⱼ = {1,2} and C_kₗ = {2}, the arc (Cᵢⱼ, C_kₗ) is inconsistent because value 1 in Cᵢⱼ has support, but value 2 doesn't (it conflicts with C_kₗ=2).
  
  Describe AC-3 for Sudoku: (1) Initialize queue with all arcs (Cᵢ, Cⱼ) where Cᵢ and Cⱼ share row/col/box, (2) Repeatedly dequeue arc (Cᵢ, Cⱼ) and call REVISE(Cᵢ, Cⱼ): remove values from Dᵢ that have no support in Dⱼ, (3) If Dᵢ changed, enqueue all arcs (C_k, Cᵢ) (neighbors of Cᵢ), (4) If any domain becomes empty, return failure. Give pseudocode for AC3_SUDOKU(csp) and REVISE(Cᵢ, Cⱼ). Demonstrate by hand on 4×4 Sudoku: starting domains, arc queue, several REVISE steps, cascading propagation.

  **Level 2** Implement AC-3 for Sudoku with AllDifferent constraints (not-equal for all pairs in row/col/box). Test on easy Sudoku: does AC-3 solve it completely (all domains reduced to singletons)? On medium Sudoku: does AC-3 shrink domains enough that backtracking becomes trivial? Compare three solvers: (1) backtracking alone, (2) AC-3 preprocessing + backtracking, (3) MAC (maintaining arc consistency: run AC-3 after each assignment during search). Which is fastest?

  **Level 3** Prove AC-3 terminates for Sudoku: domains only shrink (removal is monotonic), domains are finite (at most 9 values), therefore bounded iterations. Analyze time complexity: c=number of arcs (each cell has ~20 neighbors, 81 cells, so c≈81×20≈1600), d=domain size (9). Naive: O(cd³) ≈ O(1600×9³) ≈ 1.2M operations. In practice, tighter: O(cd²). Discuss why AC-3 doesn't always solve Sudoku: it enforces pairwise consistency, but some constraints are higher-order (e.g., "these three cells in a row can only be {1,2,3}" implies specific assignments, but AC-3 doesn't detect this). Introduce stronger consistency: path consistency (3-way), k-consistency. Discuss trade-offs: stronger consistency = more preprocessing, less search, but expensive to compute. For Sudoku, AC-3 is sweet spot.
answer: "AC-3 makes CSP arc-consistent: for every arc (X,Y), every value x in X's domain has some value y in Y's domain satisfying the constraint. Algorithm maintains queue of arcs, repeatedly calling REVISE(X,Y) which removes values from X's domain that have no supporting value in Y. When X's domain changes, add arcs (Z,X) back to queue. Returns false if any domain becomes empty."
topics:
  - "Arc Consistency"
  - "Constraint Propagation"
  - "AC-3"
vocab_answer:
  - word: "arc consistent"
    definition: "Property where every domain value has a compatible value in constrained neighbors"
  - word: "revise"
    definition: "To update a domain by removing unsupported values"
example_videos:
  - "https://www.youtube.com/watch?v=4cCS8rrYT14"
