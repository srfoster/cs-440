id: "m4-csp-structure"
type: "short-answer"
chapter: 2
question: |
  **Exploit the structure of Sudoku's constraint graph using tree decomposition and cutset conditioning.**

  Sudoku's constraint graph connects 81 cells with edges for "same row," "same column," and "same box." This graph has cycles (e.g., C₀₀-C₀₁-C₁₁-C₁₀ forms a square), making general solving hard. But what if Sudoku's graph were a tree? Trees have no cycles, and tree-structured CSPs can be solved in O(nd²) time—linear in variables! That's polynomial, not exponential. The key insight: remove a small set of cells (a "cutset") to break all cycles, turning Sudoku into a tree. Then enumerate assignments to those few cells, and for each, solve the remaining tree CSP efficiently. This matters because it reveals how structural properties (treewidth) determine computational difficulty, connecting to graph theory and complexity theory.

  **Level 0** Discuss why Sudoku structure matters. General CSP is NP-complete. But is Sudoku always hard? Consider a variant: 9×1 "Sudoku" (single row, AllDifferent constraint). This is a tree CSP: each cell depends only on itself (no cycles). Solvable in O(n) time. Real Sudoku has cycles: row intersects column, column intersects box. But cycles can be "broken" by fixing variables. Compare with 8-puzzle (Chapter 1): there structure = state space graph topology; here structure = constraint graph topology.

  **Level 1** **Tree-Structured CSP:** Suppose Sudoku's constraint graph were a tree (hypothetically). Algorithm: (1) Pick arbitrary root cell, (2) Enforce arc consistency from leaves toward root (directional), (3) Assign root any value in its domain, (4) Assign children values consistent with parents, propagating root-to-leaves. Give pseudocode for TREE_CSP_SOLVE(csp, root). Demonstrate on toy example: 5 cells in a chain C₀-C₁-C₂-C₃-C₄, domains {1,2,3}, adjacent cells must differ.
  
  **Cutset Conditioning for Sudoku:** Real Sudoku isn't a tree. Find a cutset: a small set of cells whose removal makes the remaining graph a tree. Example: if we assign all cells in column 0 (9 cells), the remaining 72 cells might form a tree (depends on Sudoku's structure—actually doesn't quite, but simplified for illustration). Algorithm: (1) Enumerate all 9^9 assignments to column 0, (2) For each, run AC-3 on remaining 72 cells, (3) If AC-3 succeeds, solve as tree CSP, (4) If solution found, return. Give pseudocode for CUTSET_CONDITIONING_SUDOKU(csp, cutsetCells). Demonstrate on 4×4 Sudoku with cutset of 2 cells.

  **Level 2** Implement tree CSP solver: given a tree-structured constraint graph (you can construct artificial examples or chains), enforce directional consistency, then assign values. For Sudoku: implement cutset conditioning with a small cutset (try 3-5 cells). Compare with backtracking: if cutset size c=5, you enumerate 9^5≈590K assignments, each requiring tree solve O(81×9²)≈6K ops, total ≈350M ops. Is this better than backtracking with AC-3? Test empirically.

  **Level 3** Define treewidth for Sudoku: minimum cutset size over all possible tree decompositions. Sudoku's treewidth is approximately 9 (roughly one row/column). General result: CSP with treewidth w solvable in O(n·d^(w+1)). For Sudoku: O(81·9^(9+1)) ≈ 10^12. Still exponential! But treewidth explains why some CSPs are easier: small treewidth ⇒ tractable. Prove tree CSP correctness: directional consistency + root-to-leaf assignment finds a solution if one exists. Compare structural approaches: cycle cutset (what we did), tree decomposition (more general), hypertree width. Discuss: for Sudoku, backtracking+AC-3+heuristics usually beats cutset conditioning because constant factors matter. But for CSPs with small treewidth (e.g., 2-3), structural methods win.
answer: "Tree CSPs solve in O(nd²): enforce directional arc consistency leaves→root, then assign root→leaves. Cutset conditioning: enumerate assignments to small variable set (cutset) that makes remaining graph a tree, solve tree CSP for each. Complexity O(d^c · nd²) where c=cutset size. Treewidth w: minimum cutset size over all decompositions. General CSPs solvable in O(n·d^(w+1)). Structure exploitation converts NP-hard to tractable."
topics:
  - "Tree-Structured CSP"
  - "Cutset Conditioning"
  - "Treewidth"
  - "Structural Decomposition"
vocab_answer:
  - word: "treewidth"
    definition: "Measure of how tree-like a graph is; minimum cutset size"
  - word: "cutset"
    definition: "Set of variables whose removal makes constraint graph a tree"
  - word: "directional consistency"
    definition: "Arc consistency enforced in one direction through a tree"
example_videos:
  - "https://www.youtube.com/watch?v=hJ-6Ma1veUE"
